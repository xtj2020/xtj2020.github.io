# 处理流程

通过特征选择后所挑选出那些具有预测价值特征集合通常被称为“影像组学标签（radiomic signature）”


>参考: \
<https://blog.csdn.net/liaopiankun0618/article/details/84328219>


## 图像采集

主要通过CT、MRI和PET-CT等影像扫描方式来进行图像的采集。

- CT是影像组学研究中使用最广泛的成像模式，其具有空间分辨率高的影像特点，可评估肿瘤和淋巴结的组织密度、形状、质地及纹理特征。

- PET-CT可同时获得组织的密度及代谢信息，常用于肿瘤的检测和分期，是影像组学将功能成像与潜在肿瘤生物学行为直接进行关联的一种研究手段。

- MRI在软组织成像中表现突出，可提供高对比度的结构信息和功能信息，其中弥散加权成像（DWI）和动态对比增强磁共振成像（DCE-MRI）可以反应组织细胞结构及微血管生成情况，通过对这些图像的采集，可提取更有效的影像组学特征。

## 图像分割

在影像图像上勾画出感兴趣区域，从而针对这一特定区域计算出影像组学特征。目前，图像分割的方法有3种，即人工分割法、半自动分割法及自动分割法。

- 手动分割法被应用于大多数影像学研究中，其优势在于准确度高并且对不规则的肿瘤边界勾画精细，但其受主观因素影响较大，可重复性低，且耗时久、效率低。

- 自动或半自动分割法则表现出较高的可重复性和时效性，其中半自动分割法为目前影像组学图像分割的主要方法。例如，MattonenSA等对肺癌的研究中指出先由研究者根据实体肿瘤反应评估标准（the ResponseEvaluation Criteria in Solid Tumors，RECIST 1.1）测量肿瘤最长轴径，然后再用自动算法去勾勒出实体肿瘤的区域，从而完成图像分割。

- 自动分割法可以实现排除人为因素，更好地达到自动化、可重复且效率高的效果。目前，应用于影像组学的完全自动分割法还没有统一的方案及标准，但是自动分割技术已经初有成效，其中，CAD自动分割乳腺肿瘤已应用十余年，其分割结果的准确性跟人工手动分割相比无几差别。这些都表明实现感兴趣区的自动分割法将是未来影像组学图像分割的一个重要研究方向。

## 图像特征提取和量化

影像组学特征可以分为：形状特征，一阶直方图特征，二阶直方图或纹理特征。还有一些获取于特定图像的影像组学特征（如PET中的SUV度量），以及仅适用于多模式数据集的分形和融合特征。

- （1）形状特征：包括描述ROI大小的特征，例如体积、表面积、二维和三维的最大直径以及有效直径（与ROI具有相同体积的球体直径），以及描述ROI与球体的相似程度的特征，如表面体积比、致密度、偏心度、球形度等。

- （2）一阶直方图特征：描述与ROI内的体素强度分布有关的特征，不包含它们之间相互的空间作用，可通过直方图分析计算得到，包括均数、中位数、最小值、最大值、标准差、偏度和峰度。这些特征可反应所测体素的对称性、均匀性以及局部强度分布变化。

- （3）二阶直方图或纹理特征:是描述体素空间分布强度等级的特征。图像纹理是指在强度水平可感知或可测量的空间变化，它被视为一个灰度级，是一种视觉感知的图像局部特征的综合[9]。二阶特征包括：灰度共生矩阵（gray level co-occurrence matrix，GLCM）、灰度级长矩阵（gray level run-length matrix，GLRLM）、灰度级带矩阵（gray level size zone matrix，GLSZM）和邻域灰度差分矩阵（neighborhood gray-tone differencematrix，NGTDM）。

- a)GLCM是一个其行列数表示灰度值、单元格包含灰度值处于一定关系（角度、距离）次数的矩阵，也称为二阶直方图。在GLCM上计算的特征包括熵（二阶熵，与异质性有关）、能量（也被定义为角二次矩，再次描述图像的均匀性）、对比度（其测量局部变化）、同质性（图像局部灰度均衡性的度量）、不相似性和相关性。

- b)GLRLM是二维矩阵，其中每个元素（i，j）描述了ja灰度级i在指定的方向上连续出现的次数[10]，灰度运行是在图像中预设方向上具有相同强度的连续体素的长度。
 
- c)GLSZM是在行和列处的元素存储具有灰度级和大小的区域（具有相同灰度级的连接体素）数量的矩阵。GLSZM包括描述小/大区和低/高灰度区分布的特征。

- d)NGTDM，其第i项是所有具有灰色调i的像素与其周围邻域像素平均值之差的总和。NGTDM的影像组学特征包括粗糙度、对比度、冗繁度、复杂度、纹理强度等。

- 融合和分形特征：融合特征与多模态图像数据集相关，其可通过配准技术与几何图像对齐。分形特征是分析评估不同层面表面的自相似性和粗糙度,这些区域的复杂性由Hausdorff的分形维（fractal dimension, FD）量化呈现，该分形维是一个模式的自我重复纹理，并具有放大特征。

## 特征选择（也就是特征降维，筛选出有效特征，这是核心）
最简单的特征选择方法是根据变量的稳定程度或相关性制定一个评分标准，以此标准对变量进行筛选。另外，在消除相关特征时，使用相关矩阵消除高度相关的特征，通过消除那些高度相关的特性，剩下“非冗余”的特征集，其中常用的方法有LASSO（least absolute shrinkage and selection operator）Cox回归模型、最大相关最小冗余（maximum relevance and minimum redundancy，mRMR）、RELIEF (RELevance In EstimatingFeatures)、主成分分析法(principal component analysis，PCA)等（之前用过PLS相关与回归分析，仍然可以用于我们的超声实验，PLS相关是集合主成分分析和典型相关分析的一种分析方法，其他的方法我觉得都不如PLS方法好，因为PLS既能解决y多x少的情况，也能解决x之间相关性比较强的情况）。

## 建立模型（预测与分类模型，与上述的特征选择可以一起做）
在影像组学建模中，logistic回归模型因其简单易行，成为最受欢迎且常用的监督分类器；另外，常用的机器学习模型还有随机森林（random forest）、支持向量机（SVM）、人工神经网络（Artificial neural networks，ANNs）、聚类分析（clustering analysis）、“leave-one out”交叉验证（LOOCV）、自举法（bootstrapping）。

- 1、随机森林：是基于机器学习中一个较普遍的决策树概念，将假设表示为连续的“如果-然后”，这一点很类似于人类推理。在该方法中，训练一组决策树，并且该算法引入两个级别的随机化。所有的决策树被训练后，对所有单株树进行预测，并将选出最高频的一类作为最终结果。
- 2、支持向量机：是一种先前用于CAD的有辨识监督机器学习的技术，它利用边界将数据点分为两类（如反应者或无反应者），该方法在CAD微钙化检测中有较高的判别力，并经常用于影像组学。
- 3、人工神经网络：是经典的机器学习方法之一，也被用于基于超分类的基因组学研究。卷积神经网络（Convolutional Neural Network，CNN）是一种特殊的前馈神经网络，用于学习直接对原始图像进行操作的图像数据的分层表现，通过尝试自动提取高度表现的成像特征，CNN消除了对图像预处理和特征选择的依赖性。该方法在MRI对三阴乳腺癌的判别中要优于其他预测模型。
- 4、聚类分析：属于无监督分类（unsupervised classifiers），其可将抽象对象集合分组，在分组的过程中对类似的对象组成的多个类进行分析，目标是在相似的基础上收集数据来进行分类。共识聚类（consensusclusterin）是常用于降维的聚类分析。有报道称共识聚类可以在440个特征的集合空间中识别出13个非冗余特征聚类。
- 5、交叉验证：该算法除了一个数据点被用于测试外其余所有数据均用于训练或拟合，这个过程在每次LOOCV迭代中重复，使得每个数据点只剩下一次。
- 6、自举法：由原始数据生成大量自举样本，引导数据集是一系列数据（特征，结果），每个数据来自患者队列中随机选择的患者，每个自举样本重复建模。该方法提供了模型参数和模型评估指数AUC或CI值的分布，从而可以评估特征的不确定性。
注：
①随机森林推荐使用R包:randomForestSRC


## 影像组学的应用
1、CT纹理在肺癌鉴别、治疗、生存期预测的应用； \
2、采用深度学习（基于分割和分类的卷积神经网络CNNs）检测膝关节磁共振中软骨病变；\
3、深度卷积神经网络（DCNN）在MR成像进行肝纤维化分期；\
4、MR成像的放射组学分析鉴别良恶性乳腺病变； \
5、利用影像组学分类心机梗塞；\
6、CT图像纹理特征预测治疗的肝癌晚期


# Pyradiomics

在PyRadiomics中可以通过4种方式自定义特征提取：
1）指定用于提取特征的图像类型（原始图像或者基于变换的派生图像）
2）指定要提取的特征类
3）指定一个设置文件来控制预处理、图像变换的滤波器和特征类
4）指定voxel-based基于体素的特定设置，只有在使用PyRadiomics 进行体素提取生成特征图时才需要

 \
使用部分:<https://cloud.tencent.com/developer/article/1662581>

# 理论部分

>理论部分:<https://cloud.tencent.com/developer/article/1660808>

1）Original：原始图像
派生图像：
2）Wavelet：小波滤波
3）LoG：高斯滤波器的拉普拉斯算子，是一种边缘增强滤波器，强调的是灰度变化的区域，sigma参数定义要强调的纹理粗糙度，该值较低则强调较细的纹理，该值较高则强调较粗糙的纹理。
4）Square：平方，即获取图像强度值的平方
5）SquareRoot：平方根，即获取图像强度值的平方根
6）Logarithm：对数，获取图像绝对强度+1的对数
7）Exponential：指数，获取图像强度值的指数
8）Gradient：梯度，获取图像局部梯度的大小
9）LocalBinaryPattern2D：本地二进制模型（2D）
10）LocalBinaryPattern3D：本地二进制模型（3D）
